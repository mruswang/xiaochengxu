<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="viewport"
          content="width=device-width, initial-scale=1">
    <title>完善资料</title>
    <link rel="stylesheet" href="./amazeui.min.css">
    <link rel="stylesheet" href="./perfect-data.css">
</head>
<body>
<div class="am-g img-top">
    <div class="back">
        <i class="am-icon-angle-left"></i>
    </div>
    <div class="title">
        <span>完善资料</span>
    </div>
    <div class="right">
        <span>保存</span>
    </div>
</div>
<div class="top-tou">
    <img src="../img/tou.png" alt="">
    <p>
        <label class="am-icon-edit">点击修改头像<input type="file" style="display: none;" /></label>
    </p>
</div>
<div class="p-content">
    <div class="p-i">
        <span class="p-i-l">用户ID</span>
        <span class="p-i-r">84575632</span>
    </div>
    <div class="p-i">
        <span class="p-i-l">昵称</span>
        <input class="p-i-r" type="text" value="Asdes">
    </div>
    <div class="p-i">
        <span class="p-i-l">性别</span>
        <div class="p-i-r p-sex">
            <div>
                <i class="am-icon-circle-thin"></i>
                <span>男</span>
            </div>
            <div>
                <i class="am-icon-check-circle-o"></i>
                <span>女</span>
            </div>
        </div>
    </div>
    <div class="p-i" id="birthday">
        <span class="p-i-l">生日</span>
        <div class="p-i-r p-i-j">
            <span class="p-i-gray">选择生日</span>
            <i class="am-icon-angle-right"></i>
        </div>
    </div>
    <div class="p-i" id="sel_city"> 
        <span class="p-i-l">城市</span>
        <div class="p-i-r p-i-j">
            <span class="p-i-gray">选择城市</span>
            <i class="am-icon-angle-right"></i>
        </div>
    </div>
    <div class="p-i">
        <span class="p-i-l">职业</span>
        <input class="p-i-r" type="text" value="" placeholder="填写职业">
    </div>
    <div class="p-i">
        <span class="p-i-l">个性签名</span>
        <input class="p-i-r" type="text" value="" placeholder="填写你的个性签名">
    </div>
</div>
<script src="./jquery-3.3.1.min.js"></script>
<script src="./amazeui.min.js"></script>
<script src="./picker.min.js"></script>
<script src="./addr.js"></script>
<script src="./datePicker.js"></script>
<script type="text/javascript">
    //男女选择
    $('.p-sex').children('div').on('click',function(){
        if($(this).find('i').hasClass('am-icon-check-circle-o')){

        }else{
            $(this).find('i').removeClass('am-icon-circle-thin')
            $(this).find('i').addClass('am-icon-check-circle-o')
            $(this).siblings().find('i').removeClass('am-icon-check-circle-o')
            $(this).siblings().find('i').addClass('am-icon-circle-thin')
        }
        
    })
    var nameEl = document.getElementById('sel_city');

    var first = []; /* 省，直辖市 */
    var second = []; /* 市 */
    var third = []; /* 镇 */

    var selectedIndex = [0, 0, 0]; /* 默认选中的地区 */

    var checked = [0, 0, 0]; /* 已选选项 */

    function creatList(obj, list){
        obj.forEach(function(item, index, arr){
            var temp = new Object();
            temp.text = item.name;
            temp.value = item.id;
            list.push(temp);
        })
    }

    creatList(city, first);

    if (city[selectedIndex[0]].hasOwnProperty('sub')) {
        creatList(city[selectedIndex[0]].sub, second);
    } else {
        second = [{text: '', value: 0}];
    }

    if (city[selectedIndex[0]].sub[selectedIndex[1]].hasOwnProperty('sub')) {
        creatList(city[selectedIndex[0]].sub[selectedIndex[1]].sub, third);
    } else {
        third = [{text: '', value: 0}];
    }

    var picker = new Picker({
        data: [first, second, third],
        selectedIndex: selectedIndex,
        title: '地址选择'
    });

    picker.on('picker.select', function (selectedVal, selectedIndex) {
        var text1 = first[selectedIndex[0]].text;
        var text2 = second[selectedIndex[1]].text;
        var text3 = third[selectedIndex[2]] ? third[selectedIndex[2]].text : '';

        $('#sel_city').find('.p-i-gray').text(text1 + ' ' + text2 + ' ' + text3);
        console.log(selectedVal)
    });

    picker.on('picker.change', function (index, selectedIndex) {
        if (index === 0){
            firstChange();
        } else if (index === 1) {
            secondChange();
        }

        function firstChange() {
            second = [];
            third = [];
            checked[0] = selectedIndex;
            var firstCity = city[selectedIndex];
            if (firstCity.hasOwnProperty('sub')) {
                creatList(firstCity.sub, second);

                var secondCity = city[selectedIndex].sub[0]
                if (secondCity.hasOwnProperty('sub')) {
                    creatList(secondCity.sub, third);
                } else {
                    third = [{text: '', value: 0}];
                    checked[2] = 0;
                }
            } else {
                second = [{text: '', value: 0}];
                third = [{text: '', value: 0}];
                checked[1] = 0;
                checked[2] = 0;
            }

            picker.refillColumn(1, second);
            picker.refillColumn(2, third);
            picker.scrollColumn(1, 0)
            picker.scrollColumn(2, 0)
        }

        function secondChange() {
            third = [];
            checked[1] = selectedIndex;
            var first_index = checked[0];
            if (city[first_index].sub[selectedIndex].hasOwnProperty('sub')) {
                var secondCity = city[first_index].sub[selectedIndex];
                creatList(secondCity.sub, third);
                picker.refillColumn(2, third);
                picker.scrollColumn(2, 0)
            } else {
                third = [{text: '', value: 0}];
                checked[2] = 0;
                picker.refillColumn(2, third);
                picker.scrollColumn(2, 0)
            }
        }

    });

    picker.on('picker.valuechange', function (selectedVal, selectedIndex) {
        console.log(selectedVal);
        console.log(selectedIndex);
    });

    nameEl.addEventListener('click', function () {
        picker.show();
    });


    var calendar = new datePicker();
    calendar.init({
        'trigger': '#birthday', /*按钮选择器，用于触发弹出插件*/
        'type': 'date',/*模式：date日期；datetime日期时间；time时间；ym年月；*/
        'minDate':'1900-1-1',/*最小日期*/
        'maxDate':'2100-12-31',/*最大日期*/
        'onSubmit':function(){/*确认时触发事件*/
            var theSelectData=calendar.value;
            $('#birthday').find('.p-i-gray').text(theSelectData)
        },
        'onClose':function(){/*取消时触发事件*/
        }
    });
</script>
</body>
</html>
